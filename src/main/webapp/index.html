<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge"> 
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="stylesheet" type="text/css" href="./style.css"/>
	</head>
	<body>

		<div class="container">
			<div class="row">
				<div class="col-sm-6 col-sm-offset-3">
					<div id="imaginary_container"> 
						<a href="#" ><img class="center-block" src="./logo.png" /></a>
						<div class="input-group stylish-input-group">
							<input id="searchText" type="text" class="form-control"  placeholder="Search" >
							<span class="input-group-addon">
								<button id="submit" class="submit" type="submit">
									<span class="glyphicon glyphicon-search"></span>
								</button>  
							</span>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div id="searchResults" class="container">
			<hgroup class="mb20">
				<h1>Search Results</h1>
                <h2 id="spellSuggestion" class="lead"></h2>
				<h2 id="searchInformation" class="lead"></h2>
			</hgroup>

			<section id="advertisments" class="col-xs-12 col-sm-6 col-md-12"></section>
		</div>
	</body>
	<script>
	$("#searchResults").hide();

	  $(".submit").click(function() {
		    getResults();
	  });

	 $("#searchText").keyup(function(event){
	        if(event.keyCode == '13'){
	        	getResults();
	        }
	    });
	  
	 function getResults() {
	  	var searchText = document.getElementById('searchText').value;
      	$.ajax({
          type : "GET",
          url : "rest/search?searchText="+searchText,
          success : function(data) {
          	var invitations = '';
                if(data.length == 0){
                    checkSpelling(searchText);
                }else{
                    $("#spellSuggestion").hide();
                }
		        for(var i=0;i<data.length;i++){
		            var content = data[i].content;
                  content = truncateText(content,200);
			        invitations=invitations.concat('<article class="search-result row"><div class="col-xs-12 col-sm-12 col-md-3"><a href="#" class="thumbnail"><img src="./logo.png" /></a></div><div class="col-xs-12 col-sm-12 col-md-2"><ul class="meta-search"><li><i class="glyphicon glyphicon-usd"></i> <span>Цена: ' +data[i].price+'</span></li><li><i class="glyphicon glyphicon-home"></i> <span>Квадратура: ' +data[i].area+'</span></li><li><i class="glyphicon glyphicon-th-large"></i> <span>Етаж: '+data[i].floor+'</span></li><li><i class="glyphicon glyphicon-earphone"></i> <span>Телефон: '+data[i].telephone+'</span></li></ul></div><div class="col-xs-12 col-sm-12 col-md-7 excerpet"><h3><a target="_blank" href="'+data[i].url+'" title="">'+data[i].title+'</a></h3><p>'+content+'</p></div><span class="clearfix borda"></span></article>');
		        }
		        var node = document.getElementById('advertisments');
		        node.innerHTML=invitations;

              var searchInfo = document.getElementById('searchInformation');
              searchInfo.innerHTML='<strong class="text-danger">'+data.length+'</strong> results were found for the search for <strong class="text-danger">'+searchText+'</strong>';

              $("#searchResults").show();
          },
          error: function(xhr, textStatus, errorThrown){
              alert("ERROR!!!");
          }
      	});
	  }

	 function checkSpelling(spellcheckText) {
	  	var spellSuggestion = document.getElementById('spellSuggestion');
      	$.ajax({
          type : "GET",
          url : "rest/spellcheck?misspellText="+spellcheckText,
          success : function(suggestion) {
                spellSuggestion.innerHTML='<a onclick="clickOnSuggestion(\''+suggestion+'\')" href="#">Do you mean: ' + suggestion+'</a>';
                $("#spellSuggestion").show();
          },
          error: function(xhr, textStatus, errorThrown){
              alert("ERROR!!!");
          }
      	});
	  }

    function clickOnSuggestion(suggestionText){
        document.getElementById('searchText').value = suggestionText;
        getResults();
    }
	function truncateText(text, maxLength) {
        if (text.length > maxLength) {
            text = text.substr(0,maxLength) + '...';
        }
        return text;
    }
	</script>
</html>